import{l as ie,v as le}from"./@vue.runtime-dom-DkKQpP1Z.js";import{n as G,m as ae,T as ne,B as re,aa as ce}from"./@element-plus.icons-vue-BCFYf-67.js";import{i as I,a as de,e as ue}from"./index-BzwtatPw.js";import{u as pe}from"./index-OBXFyj3D.js";import{y as me,o as fe}from"./lodash-es-I-EvhVFk.js";import{a as x,b as _e}from"./element-plus-DaJS5H-O.js";import{d as J,I as ve,A as he,e as ge,Y as b,$ as j,o as a,c as h,a as n,G as M,i as c,K as u,N as $,J as p,n as be,L as N,M as ke,F as ye,V as Ce}from"./@vue.runtime-core-B2X3lOUZ.js";import{k as K,r as E,u as m}from"./@vue.reactivity-V6IlnEmz.js";import{o as W,O as z}from"./@vue.shared-D-bMerGS.js";import{_ as we}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse.core-Bp0bPelK.js";import"./@vueuse.shared-CZpoHp70.js";import"./store-BGvsPsWR.js";import"./chardet-C_72lc3Z.js";import"./mitt-C1z4c41a.js";import"./axios-CvWkLj0m.js";import"./nprogress-B7fG2QpQ.js";import"./pinia-ByvooDwk.js";import"./vue-demi-Dq6ymT-8.js";import"./monaco-editor-CuOEaJz6.js";import"./vue-echarts-BbwyaQnR.js";import"./resize-detector-CZu9PX2v.js";import"./echarts-Bv2MlBtc.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BSc91FC-.js";import"./vue-router-4IlAtr41.js";import"./mockjs-Bfc9hT_P.js";import"./dayjs-DOBku9Nj.js";import"./vue-xN6KRtQP.js";import"./@popperjs.core-D9SI2xQl.js";import"./@ctrl.tinycolor-r5W6hzzQ.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui.dom-B8Qxuwjg.js";import"./@floating-ui.core-DTrSsA1T.js";import"./@floating-ui.utils-Bh-IyuRp.js";const xe={class:"cl-view-group__wrap"},Me={class:"cl-view-group__left"},$e={class:"scope"},Ee={class:"head"},ze={class:"data"},Be={class:"item"},Se=["infinite-scroll-disabled"],Ne=["onClick","onContextmenu"],Ve={class:"cl-view-group__right"},De={class:"head"},Fe={class:"title"},Le={key:0,class:"content"},je=J({name:"cl-view-group"}),Oe=J({...je,setup(Te,{expose:P}){ie(t=>({"117200c8":e.leftWidth}));const{browser:B,onScreenChange:Y}=de(),H=ve(),O=I.useForm(),{refs:Q,setRefs:U}=pe(),e=K(Object.assign({label:"组",title:"列表",leftWidth:"300px",data:{},service:{},enableContextMenu:!0,enableRefresh:!0,enableAdd:!0,custom:!1},he("useViewGroup__options"))),T=!!H.left;me(e.service);const V=E(!1),d=E([]),k=E(!0),r=E(),f=K(fe({visible:!!e.tree,props:{label:"name",children:"children",disabled:"disabled",isLeaf:"isLeaf",class:""},defaultExpandedKeys:[]},e.tree));function y(t){k.value=t===void 0?!k.value:t}function C(t){t||(t=d.value[0]),r.value=t,be(()=>{t&&(B.isMini&&y(!1),e.onSelect&&e.onSelect(t))})}function D(t){var s,i;(i=O.value)==null||i.open({title:(t?"编辑":"添加")+e.label,form:{...t},on:{submit(l,{close:_,done:v}){e.service[t?"update":"add"](l).then(()=>{x.success("保存成功"),t?Object.assign(t,l):g(),_()}).catch(F=>{x.error(F.message),v()})}},...(s=e.onEdit)==null?void 0:s.call(e,t)})}function A(t){_e.confirm("此操作将会删除选择的数据，是否继续？","提示",{type:"warning"}).then(()=>{e.service.delete({ids:[t.id]}).then(async()=>{var s;x.success("删除成功"),await g(),((s=r.value)==null?void 0:s.id)==t.id&&C()}).catch(s=>{x.error(s.message)})}).catch(()=>null)}const S={order:"createTime",sort:"asc",page:1,size:50},R=E(!1);async function g(t){if(T)return!1;Object.assign(S,t),V.value=!0;const s={...S,...e.data};let i;f.visible?i=e.service.list(s).then(l=>{d.value=ue(l)}):i=e.service.page(s).then(l=>{var v;const _=((v=e.onData)==null?void 0:v.call(e,l.list))||l.list;S.page==1?d.value=_:d.value.push(..._),R.value=l.pagination.total<=d.value.length}),await i.then(()=>{const l=r.value||d.value[0];l&&(f.visible&&Q.tree.getNode(l).expand(),C(l))}).catch(l=>{x.error(l.message)}),V.value=!1}function X(){g({page:S.page+1})}function Z(t,s){if(!e.enableContextMenu)return!1;I.ContextMenu.open(t,{hover:{target:"item"},list:[{label:"编辑",hidden:!e.service._permission.update,callback(i){i(),D(s)}},{label:"删除",hidden:!e.service._permission.delete,callback(i){i(),A(s)}}],...e.onContextMenu&&e.onContextMenu(s)})}return Y(()=>{y(!B.isMini)}),ge(()=>{g()}),P({list:d,selected:r,isExpand:k,expand:y,select:C,browser:B,edit:D,remove:A,refresh:g}),(t,s)=>{const i=b("el-icon"),l=b("el-tooltip"),_=b("el-tree"),v=b("el-empty"),F=b("el-scrollbar"),ee=b("cl-form"),te=j("permission"),se=j("infinite-scroll"),oe=j("loading");return a(),h("div",{class:W(["cl-view-group",[k.value?"is-expand":"is-collapse"]])},[n("div",xe,[n("div",Me,[M(t.$slots,"left",{},()=>[n("div",$e,[n("div",Ee,[n("span",null,z(e.label),1),e.enableRefresh?(a(),p(l,{key:0,content:"刷新"},{default:u(()=>[c(i,{onClick:s[0]||(s[0]=o=>g())},{default:u(()=>[c(m(ne))]),_:1})]),_:1})):$("",!0),e.enableAdd?(a(),p(l,{key:1,content:"添加"},{default:u(()=>[N((a(),p(i,{onClick:s[1]||(s[1]=o=>D())},{default:u(()=>[c(m(re))]),_:1})),[[te,e.service.permission.add]])]),_:1})):$("",!0)]),N((a(),h("div",ze,[c(F,null,{default:u(()=>[f.visible?(a(),p(_,{key:0,class:"tree","highlight-current":"","auto-expand-parent":"","expand-on-click-node":!1,ref:m(U)("tree"),lazy:f.lazy,data:d.value,props:f.props,load:f.onLoad,onNodeClick:C},{default:u(({data:o})=>[n("div",Be,[o.icon?(a(),p(ke(o.icon),{key:0})):$("",!0),n("span",null,z(o[f.props.label]),1)])]),_:1},8,["lazy","data","props","load"])):N((a(),h("ul",{key:1,class:"list","infinite-scroll-immediate":!1,"infinite-scroll-disabled":R.value},[(a(!0),h(ye,null,Ce(d.value,(o,L)=>(a(),h("li",{key:L,onClick:w=>C(o),onContextmenu:w=>{Z(w,o)}},[M(t.$slots,"item",{item:o,selected:r.value,index:L},()=>{var w,q;return[n("div",{class:W(["item",{"is-active":((w=r.value)==null?void 0:w.id)==o.id}])},[M(t.$slots,"item-name",{item:o,selected:r.value,index:L},()=>[n("span",null,z(o.name),1)],!0),N(c(i,{class:"arrow-right"},{default:u(()=>[c(m(ce))]),_:2},1536),[[le,((q=r.value)==null?void 0:q.id)==o.id]])],2)]},!0)],40,Ne))),128)),d.value.length==0?(a(),p(v,{key:0,"image-size":80})):$("",!0)],8,Se)),[[se,X]])]),_:3})])),[[oe,V.value]])])],!0),m(B).isMini?(a(),h("div",{key:0,class:"collapse-btn",onClick:s[2]||(s[2]=o=>y(!1))},[c(i,null,{default:u(()=>[c(m(G))]),_:1})])):$("",!0)]),n("div",Ve,[n("div",De,[n("div",{class:"icon",onClick:s[3]||(s[3]=o=>y())},[k.value?(a(),p(i,{key:0},{default:u(()=>[c(m(ae))]),_:1})):(a(),p(i,{key:1},{default:u(()=>[c(m(G))]),_:1}))]),M(t.$slots,"title",{selected:r.value},()=>{var o;return[n("span",Fe,z(e.title)+"（"+z(((o=r.value)==null?void 0:o.name)||"未选择")+"） ",1)]},!0)]),r.value||e.custom?(a(),h("div",Le,[M(t.$slots,"right",{},void 0,!0)])):(a(),p(v,{key:1,"image-size":80}))])]),c(ee,{ref_key:"Form",ref:O},null,512)],2)}}}),Ct=we(Oe,[["__scopeId","data-v-164d4981"]]);export{Ct as default};
