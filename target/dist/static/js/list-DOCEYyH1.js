import{w as S}from"./@vue.runtime-dom-DkKQpP1Z.js";import{i as Y,a as K}from"./index-BzwtatPw.js";import"./store-BGvsPsWR.js";import{u as A}from"./index-OBXFyj3D.js";import{B as P,Y as R,Z as U,_ as Z,P as j}from"./@element-plus.icons-vue-BCFYf-67.js";import{d as F,Y as l,o as c,J as T,K as i,i as n,n as G,ap as Q,$ as X,c as v,a as p,F as W,V as ee,L as $,av as te,au as oe,O as L}from"./@vue.runtime-core-B2X3lOUZ.js";import{r as O,k as se,u as r}from"./@vue.reactivity-V6IlnEmz.js";import{a as b,b as H}from"./element-plus-DaJS5H-O.js";import{o as ne,O as N}from"./@vue.shared-D-bMerGS.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse.core-Bp0bPelK.js";import"./@vueuse.shared-CZpoHp70.js";import"./lodash-es-I-EvhVFk.js";import"./mitt-C1z4c41a.js";import"./axios-CvWkLj0m.js";import"./nprogress-B7fG2QpQ.js";import"./chardet-C_72lc3Z.js";import"./pinia-ByvooDwk.js";import"./vue-demi-Dq6ymT-8.js";import"./monaco-editor-CuOEaJz6.js";import"./vue-echarts-BbwyaQnR.js";import"./resize-detector-CZu9PX2v.js";import"./echarts-Bv2MlBtc.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BSc91FC-.js";import"./vue-router-4IlAtr41.js";import"./mockjs-Bfc9hT_P.js";import"./dayjs-DOBku9Nj.js";import"./vue-xN6KRtQP.js";import"./@popperjs.core-D9SI2xQl.js";import"./@ctrl.tinycolor-r5W6hzzQ.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui.dom-B8Qxuwjg.js";import"./@floating-ui.core-DTrSsA1T.js";import"./@floating-ui.utils-Bh-IyuRp.js";const le=F({name:"undefined"}),ie=F({...le,setup(g,{expose:s}){const{service:I}=A(),f=O(!1),M=O(""),y=se({status:[{label:"成功",value:1,type:"success"},{label:"失败",value:0,type:"danger"}]}),B=Y.useTable({autoHeight:!1,columns:[{label:"#",type:"index"},{label:"描述",prop:"detail",showOverflowTooltip:!0,minWidth:200},{label:"执行状态",prop:"status",minWidth:120,dict:y.status},{label:"执行时间",prop:"createTime",minWidth:160}]}),u=Y.useCrud({service:I.task.info,dict:{api:{page:"log"}}});function D(k){f.value=!0,M.value=`日志列表（${k.name}）`,G(()=>{var m;(m=u.value)==null||m.refresh({id:k.id,page:1})})}function V(){f.value=!1}return s({open:D,close:V}),(k,m)=>{const x=l("cl-refresh-btn"),q=l("cl-select"),E=l("cl-filter"),t=l("cl-row"),o=l("cl-table"),e=l("cl-flex1"),d=l("cl-pagination"),C=l("cl-crud"),w=l("cl-dialog");return c(),T(w,{modelValue:f.value,"onUpdate:modelValue":m[0]||(m[0]=_=>f.value=_),title:M.value,width:"1000px"},{default:i(()=>[n(C,{ref_key:"Crud",ref:u,padding:"0"},{default:i(()=>[n(t,null,{default:i(()=>[n(x),n(E,{label:"状态"},{default:i(()=>[n(q,{options:y.status,prop:"status",width:120},null,8,["options"])]),_:1})]),_:1}),n(t,null,{default:i(()=>[n(o,{ref_key:"Table",ref:B},null,512)]),_:1}),n(t,null,{default:i(()=>[n(e),n(d)]),_:1})]),_:1},512)]),_:1},8,["modelValue","title"])}}}),z=g=>(te("data-v-084c378a"),g=g(),oe(),g),re={class:"list"},ce=["onClick","onContextmenu"],pe={class:"name"},ue={class:"row"},de=z(()=>p("span",null,"执行服务",-1)),me={class:"row"},_e=z(()=>p("span",null,"定时规则",-1)),fe={class:"status"},ke=z(()=>p("p",null,"添加计划任务",-1)),he=F({name:"task-list"}),ve=F({...he,setup(g){const{service:s,refs:I,setRefs:f}=A(),{browser:M}=K(),y=Y.useForm(),B=O([]);function u(){s.task.info.page({size:100,page:1}).then(t=>{B.value=t.list.map(o=>(o.every&&(o._every=parseInt(String(o.every/1e3))),o))})}function D(t){H.confirm(`此操作将启用任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.start({id:t.id,type:t.type}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function V(t){H.confirm(`此操作将停用任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.stop({id:t.id}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function k(t){H.confirm(`此操作将删除任务（${t.name}），是否继续？`,"提示",{type:"warning"}).then(()=>{s.task.info.delete({ids:[t.id]}).then(()=>{u()}).catch(o=>{b.error(o.message)})}).catch(()=>null)}function m(t){I.log.open(t)}async function x(t){var o;if(t&&!s.task.info._permission.update)return!1;(o=y.value)==null||o.open({title:"编辑计划任务",width:"600px",props:{labelWidth:"80px"},items:[{label:"名称",prop:"name",component:{name:"el-input",props:{placeholder:"请输入名称"}},required:!0},{label:"类型",prop:"taskType",value:0,component:{name:"el-radio-group",options:[{label:"cron",value:0},{label:"时间间隔",value:1}]},required:!0},{label:"cron",prop:"cron",hidden:({scope:e})=>e.taskType==1,component:{name:"el-input",props:{placeholder:"* * * * * *"}},required:!0},{label:"间隔(秒)",prop:"every",hidden:({scope:e})=>e.taskType==0,hook:{bind(e){return e/1e3},submit(e){return e*1e3}},component:{name:"el-input-number",props:{min:1,max:1e8}},required:!0},{label:"service",prop:"service",component:{name:"el-input",props:{placeholder:"taskDemoService.test([1, 2])"}}},{label:"开始时间",prop:"startDate",hidden:({scope:e})=>e.taskType==1,component:{name:"el-date-picker",props:{type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:3}}}],form:{...t},on:{submit:(e,{close:d,done:C})=>{e.limit||(e.limit=null),s.task.info[t!=null&&t.id?"update":"add"](e).then(()=>{u(),b.success("保存成功"),d()}).catch(w=>{b.error(w.message),C()})}}})}function q(t){s.task.info.once({id:t.id}).then(()=>{u()}).catch(o=>{b.error(o.message)})}function E(t,o){Y.ContextMenu.open(t,{list:[o.status?{label:"暂停",hidden:!s.task.info._permission.stop,callback(e){V(o),e()}}:{label:"开始",hidden:!s.task.info._permission.start,callback(e){D(o),e()}},{label:"立即执行",hidden:!s.task.info._permission.once,callback(e){q(o),e()}},{label:"编辑",hidden:!(s.task.info._permission.update&&s.task.info._permission.info),callback(e){x(o),e()}},{label:"删除",hidden:!s.task.info._permission.delete,callback(e){k(o),e()}},{label:"查看日志",hidden:!s.task.info._permission.log,callback(e){m(o),e()}}]})}return Q(()=>{u()}),(t,o)=>{const e=l("el-tag"),d=l("el-icon"),C=l("cl-flex1"),w=l("cl-form"),_=X("permission");return c(),v("div",{class:ne(["task-list",{"is-mini":r(M).isMini}])},[p("div",re,[(c(!0),v(W,null,ee(B.value,(a,J)=>(c(),v("div",{key:J,class:"item",onClick:h=>x(a),onContextmenu:h=>{E(h,a)}},[p("p",pe,N(a.name),1),p("p",ue,[de,p("span",null,N(a.service),1)]),p("p",me,[_e,p("span",null,N(a.taskType==1?`间隔${a._every}秒执行`:a.cron),1)]),p("div",fe,[a.status?(c(),v(W,{key:0},[n(e,{"disable-transitions":"",effect:"dark",type:"success"},{default:i(()=>[L("进行中")]),_:1}),$((c(),T(d,{class:"pause",onClick:S(h=>V(a),["stop"])},{default:i(()=>[n(r(R))]),_:2},1032,["onClick"])),[[_,r(s).task.info.permission.stop]])],64)):(c(),v(W,{key:1},[n(e,{"disable-transitions":"",effect:"dark",type:"danger"},{default:i(()=>[L("已停止")]),_:1}),$((c(),T(d,{class:"play",onClick:S(h=>D(a),["stop"])},{default:i(()=>[n(r(U))]),_:2},1032,["onClick"])),[[_,r(s).task.info.permission.start]])],64)),n(C),$((c(),T(d,{class:"log",onClick:S(h=>m(a),["stop"])},{default:i(()=>[n(r(Z))]),_:2},1032,["onClick"])),[[_,r(s).task.info.permission.log]]),$((c(),T(d,{class:"delete",onClick:S(h=>k(a),["stop"])},{default:i(()=>[n(r(j))]),_:2},1032,["onClick"])),[[_,r(s).task.info.permission.delete]])])],40,ce))),128)),$((c(),v("div",{class:"item is-add",onClick:o[0]||(o[0]=a=>x())},[n(d,null,{default:i(()=>[n(r(P))]),_:1}),ke])),[[_,r(s).task.info.permission.add]])]),n(w,{ref_key:"Form",ref:y},null,512),n(ie,{ref:r(f)("log")},null,512)],2)}}}),ot=ae(ve,[["__scopeId","data-v-084c378a"]]);export{ot as default};
