import{v as D,w}from"./@vue.runtime-dom-DkKQpP1Z.js";import{Y as q,Z as F,u as J,P as K}from"./@element-plus.icons-vue-BCFYf-67.js";import{m as Y,l as W,n as j,i as Z}from"./index-BzwtatPw.js";import{u as z}from"./index-OBXFyj3D.js";import{C as N}from"./lodash-es-I-EvhVFk.js";import{a as G}from"./@vueuse.core-Bp0bPelK.js";import"./store-BGvsPsWR.js";import{d as M,Y as b,$ as H,o as i,c as r,a as c,J as _,N as h,i as v,K as k,L as O,F as I,n as Q,t as R,q as X,e as ee,a4 as te}from"./@vue.runtime-core-B2X3lOUZ.js";import{k as V,u as m}from"./@vue.reactivity-V6IlnEmz.js";import{_ as S}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as oe}from"./element-plus-DaJS5H-O.js";import{O as x,o as U,p as ie}from"./@vue.shared-D-bMerGS.js";const{options:se}=Y.get("upload"),$=se.rules||[];function le(e){return W(e.substring(e.indexOf("_")+1))}function ae(e){return $.find(o=>o.exts.find(f=>f==j(e||"").toLocaleLowerCase()))||N($)}function ne(e){return $.find(a=>a.type==e)||N($)}function re(e){return ae(e).type}function Se(e){return e.map(a=>a.url.replace(/,/g,encodeURIComponent(",")))}function Te(...e){if(e.length===0)return"";const a=e[0];let o=!1;a.startsWith("http")&&(o=!0);const f=e.map(n=>n.replace(/(^\/+|\/+$)/g,""));return f.join("/")}const ce={class:"viewer-image"},ue={class:"viewer-doc"},de=["src"],me=M({name:"file-viewer"}),fe=M({...me,setup(e,{expose:a}){const{refs:o,setRefs:f}=z(),n=V({visible:!1,url:""}),l=V({visible:!1,loading:!1,url:""});function P(u){if(u!=null&&u.type){const d=u.url||"",g=re(d);if(g=="image")return n.visible=!0,n.url=d,!0;if(["word","excel","ppt","pdf"].includes(g))return l.visible=!0,l.loading=!0,l.url=`https://view.officeapps.live.com/op/view.aspx?src=${decodeURIComponent(d)}`,Q(()=>{o.docIframe.onload=()=>{l.loading=!1}}),!0;window.open(u.url)}}function y(){n.visible=!1}return a({open:P}),(u,d)=>{const g=b("el-image-viewer"),B=b("cl-dialog"),p=H("loading");return i(),r(I,null,[c("div",ce,[n.visible?(i(),_(g,{key:0,"url-list":[n.url],infinite:"",teleported:"",onClose:y},null,8,["url-list"])):h("",!0)]),v(B,{modelValue:l.visible,"onUpdate:modelValue":d[0]||(d[0]=t=>l.visible=t),title:"文档预览",height:"70vh",width:"80%",scrollbar:!1},{default:k(()=>[O((i(),r("div",ue,[c("iframe",{src:l.url,ref:m(f)("docIframe")},null,8,de)])),[[p,l.loading]])]),_:1},8,["modelValue"])],64)}}}),pe=S(fe,[["__scopeId","data-v-0ddb777b"]]),ve={class:"cl-upload-item__wrap"},ge=["src"],_e={class:"cl-upload-item__icon"},ye={class:"cl-upload-item__name"},be=["src"],we={class:"cl-upload-item__progress-bar"},he={class:"cl-upload-item__progress-value"},ke={key:5,class:"cl-upload-item__actions"},Ce=M({name:"cl-upload-item"}),xe=M({...Ce,props:{item:{type:Object,required:!0},list:{type:Array,default:()=>[]},disabled:Boolean,deletable:Boolean,showTag:{type:Boolean,default:!0}},emits:["remove"],setup(e,{emit:a}){const o=e,f=a,{refs:n,setRefs:l}=z(),{copy:P}=G(),y=R(()=>o.item.url||""),u=R(()=>({color:ne(o.item.type).color,name:j(o.item.name||y.value)}));function d(){f("remove",o.item)}function g(){n.viewer.open(o.item)}function B(t){Z.ContextMenu.open(t,{hover:{target:"cl-upload-item__wrap"},list:[{label:"预览",callback(s){g(),s()}},{label:"复制链接",callback(s){o.item.url&&(P(o.item.url),oe.success("复制成功")),s()}},{label:"删除",callback(s){d(),s()}}]})}const p=V({isMedia:["video","audio"].includes(o.item.type),play(){o.list.forEach(t=>{t.isPlay=t.uid?o.item.uid==t.uid:o.item.id==t.id})},pause(){o.item.isPlay=!1},create(){if(!p.isMedia)return!1;let t;X(()=>o.item.isPlay,s=>{t||(t=n[o.item.type],t==null||t.addEventListener("ended",()=>{p.pause()})),s?t==null||t.play():t==null||t.pause()})}});return ee(()=>{p.create()}),(t,s)=>{const T=b("el-image"),L=b("cl-svg"),A=b("el-progress"),C=b("el-icon");return i(),r("div",ve,[(i(),_(te,null,[c("div",{class:U(["cl-upload-item",[{"is-play":e.item.isPlay}]]),onContextmenu:w(B,["stop","prevent"])},[e.item.type==="image"&&!e.item.error?(i(),_(T,{key:0,class:"cl-upload-item__image-cover",fit:"contain",src:e.item.preload||y.value,onError:s[0]||(s[0]=E=>e.item.error="加载失败")},null,8,["src"])):e.item.type==="video"?(i(),r("video",{ref:m(l)("video"),src:e.item.url,key:e.item.url},null,8,ge)):(i(),r(I,{key:2},[c("div",_e,[v(L,{name:e.item.type},null,8,["name"])]),c("div",ye,[c("span",null,x(m(le)(e.item.name||y.value)),1),O(c("span",{class:"error"},x(e.item.error),513),[[D,e.item.error]])])],64)),e.item.type==="audio"?(i(),r("audio",{key:3,controls:"",ref:m(l)("audio")},[(i(),r("source",{src:e.item.url,type:"audio/mpeg",key:e.item.url},null,8,be))],512)):h("",!0),c("div",{class:U(["cl-upload-item__progress",{"is-show":e.item.progress>=0&&e.item.progress<100,"is-hide":e.item.progress==100}])},[c("div",we,[v(A,{percentage:e.item.progress,"show-text":!1},null,8,["percentage"])]),c("span",he,x(e.item.progress),1)],2),e.showTag?(i(),r("span",{key:4,class:"cl-upload-item__tag",style:ie({backgroundColor:u.value.color})},x(u.value.name),5)):h("",!0),y.value?(i(),r("div",ke,[p.isMedia?(i(),r(I,{key:0},[e.item.isPlay?(i(),_(C,{key:0,onClick:s[1]||(s[1]=w(E=>p.pause(),["stop"]))},{default:k(()=>[v(m(q))]),_:1})):(i(),_(C,{key:1,onClick:s[2]||(s[2]=w(E=>p.play(),["stop"]))},{default:k(()=>[v(m(F))]),_:1}))],64)):(i(),_(C,{key:1,onClick:w(g,["stop"])},{default:k(()=>[v(m(J))]),_:1})),!e.disabled||e.deletable?(i(),_(C,{key:2,onClick:w(d,["stop"])},{default:k(()=>[v(m(K))]),_:1})):h("",!0)])):h("",!0)],34)],1024)),v(pe,{ref:m(l)("viewer")},null,512)])}}}),$e=S(xe,[["__scopeId","data-v-0b9f6d87"]]),Le=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{$e as U,re as a,Se as g,Le as i,Te as p};
