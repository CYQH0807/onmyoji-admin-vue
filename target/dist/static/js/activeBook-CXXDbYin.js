import{g as J,i as d}from"./index-BzwtatPw.js";import K from"./activeItem-649ZlkKJ.js";import"./store-BGvsPsWR.js";import{u as Y}from"./index-OBXFyj3D.js";import{u as z}from"./group-BfmV4XTx.js";import{j as U}from"./lodash-es-I-EvhVFk.js";import{d as j,t as H,Y as n,o as D,c as P,i as r,K as i,O as x,W as Q,V as R,a as N,J as X,M as Z}from"./@vue.runtime-core-B2X3lOUZ.js";import{r as g,u as B}from"./@vue.reactivity-V6IlnEmz.js";import{O as $}from"./@vue.shared-D-bMerGS.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue.runtime-dom-DkKQpP1Z.js";import"./element-plus-DaJS5H-O.js";import"./@element-plus.icons-vue-BCFYf-67.js";import"./@popperjs.core-D9SI2xQl.js";import"./@ctrl.tinycolor-r5W6hzzQ.js";import"./dayjs-DOBku9Nj.js";import"./chardet-C_72lc3Z.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui.dom-B8Qxuwjg.js";import"./@floating-ui.core-DTrSsA1T.js";import"./@floating-ui.utils-Bh-IyuRp.js";import"./@vueuse.core-Bp0bPelK.js";import"./@vueuse.shared-CZpoHp70.js";import"./mitt-C1z4c41a.js";import"./axios-CvWkLj0m.js";import"./nprogress-B7fG2QpQ.js";import"./pinia-ByvooDwk.js";import"./vue-demi-Dq6ymT-8.js";import"./monaco-editor-CuOEaJz6.js";import"./vue-echarts-BbwyaQnR.js";import"./resize-detector-CZu9PX2v.js";import"./echarts-Bv2MlBtc.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BSc91FC-.js";import"./vue-router-4IlAtr41.js";import"./mockjs-Bfc9hT_P.js";import"./vue-xN6KRtQP.js";const te={class:"content"},oe={class:"form-value"},re={class:"op"},ae=j({name:"dict-list"}),le=j({...ae,setup(ne){let _=g([]),v=g("");const f=g(!1),{service:c}=Y();J();const{ViewGroup:w}=z({label:"类型",title:"记录",service:c.base.onmyoji.active,onSelect(e){e.name=e.activeName,k({activeId:e.activeId,page:1})},onEdit(){return{width:"500px",props:{},items:[{label:"名称",prop:"activeName",component:{name:"el-input",props:{maxlength:20}},required:!0},{label:"描述",prop:"activeDesc",component:{name:"el-input",props:{maxlength:20}},required:!0},{label:"开始时间",prop:"activeBeginDate",component:{name:"el-date-picker",placeholder:"请选择开始时间"},required:!0},{label:"结束时间",prop:"activeEndDate",component:{name:"el-date-picker",placeholder:"请选择结束时间"},required:!0}]}}}),b=d.useUpsert({dialog:{width:"600px"},props:{labelWidth:"100px"},items:[{label:"上级节点",prop:"parentId",component:{name:"el-tree-select",props:{data:H(()=>{var o;const e=U((o=m.value)==null?void 0:o.data);function t(l,p){var u;l.id&&l.id==((u=b.value)==null?void 0:u.getForm("id"))&&(p=!0),p&&(l.disabled=!0),l.children&&l.children.forEach(s=>{t(s,p)})}return t({children:e},!1),e}),props:{label:"name",value:"id",children:"children",disabled:"disabled"},clearable:!0,filterable:!0,"default-expand-all":!0,"check-strictly":!0}}},{label:"名称",prop:"name",required:!0,component:{name:"el-input"}},{label:"值",prop:"value",component:{name:"slot-value"}},{label:"排序",prop:"orderNum",value:1,component:{name:"el-input-number",props:{min:1}}},{label:"备注",prop:"remark",component:{name:"el-input",props:{type:"textarea",rows:4}}}],onSubmit(e,{next:t}){var o,l;t({...e,typeId:(l=(o=w.value)==null?void 0:o.selected)==null?void 0:l.id})},plugins:[d.setFocus("name")]});let V=[{type:"selection"},{label:"账号",prop:"userId",align:"left",minWidth:200,formatter:e=>`${e.username}(${e.userId})`}];const m=d.useTable({contextMenu:["refresh",e=>{var t;return{label:"新增",hidden:!((t=c.dict.info._permission)!=null&&t.add),callback(o){T(e),o()}}},"edit","delete","order-asc","order-desc"],columns:V}),I=d.useCrud({service:c.base.onmyoji.activeBooks});async function E(e,t,o){await c.base.onmyoji.acitveUserItem.updateUserItem({activeItemId:t.activeItemId,userId:o.userId,activeId:o.activeId,value:e})}function q(e){k({activeId:v.value}).then(()=>{e()})}async function k(e){var o;_.value=await c.base.onmyoji.activeItem.list({activeId:e.activeId}),v.value=e.activeId;let t=U(V);_.value.forEach(l=>{t.push({label:l.activeItemName,prop:`prop${l.activeItemId}`,minWidth:200})}),t.push({type:"op",width:80,buttons:["edit"]}),m.value&&(m.value.columns=t),(o=I.value)==null||o.refresh(e)}function T(e){var t;(t=I.value)==null||t.rowAppend({parentId:e.id,orderNum:1})}function F(e){var t,o;(o=b.value)==null||o.setForm("value",(t=e[0])==null?void 0:t.url)}return(e,t)=>{const o=n("cl-refresh-btn"),l=n("el-button"),p=n("cl-flex1"),u=n("cl-search-key"),s=n("cl-row"),S=n("cl-table"),W=n("el-input"),A=n("cl-upload-space"),G=n("cl-upsert"),L=n("cl-crud"),M=n("cl-view-group"),O=n("cl-dialog");return D(),P("div",te,[r(M,{ref_key:"ViewGroup",ref:w},{"item-name":i(({item:a})=>[x($(a.activeName)+" - "+$(a.activeDesc),1)]),right:i(()=>[r(L,{ref_key:"Crud",ref:I},{default:i(()=>[r(s,null,{default:i(()=>[r(o),r(l,{type:"primary",onClick:t[0]||(t[0]=a=>f.value=!0)},{default:i(()=>[x("编辑活动项")]),_:1}),r(p),r(u,{placeholder:"搜索账号"})]),_:1}),r(s,null,{default:i(()=>[r(S,{ref_key:"Table",ref:m,"row-key":"id"},Q({_:2},[R(B(_),(a,C)=>({name:`column-prop${a.activeItemId}`,fn:i(({scope:h})=>[(D(),X(Z(a.activeItemType),{modelValue:h.row[`prop${a.activeItemId}`],"onUpdate:modelValue":y=>h.row[`prop${a.activeItemId}`]=y,"true-value":"1","false-value":"0",onChange:y=>E(y,a,h.row)},null,40,["modelValue","onUpdate:modelValue","onChange"]))])}))]),1536)]),_:1}),r(s,null,{default:i(()=>[r(p)]),_:1}),r(G,{ref_key:"Upsert",ref:b},{"slot-value":i(({scope:a})=>[N("div",oe,[r(W,{modelValue:a.value,"onUpdate:modelValue":C=>a.value=C,placeholder:"请填写值",clearable:"",type:"textarea",rows:4},null,8,["modelValue","onUpdate:modelValue"]),N("div",re,[x(" // eslint-disable-next-line prettier/prettier "),r(A,{text:"使用文件",limit:1,onConfirm:F})])])]),_:1},512)]),_:1},512)]),_:1},512),r(O,{title:"活动项",width:"80%",modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=a=>f.value=a),"before-close":q},{default:i(()=>[r(K,{activeId:B(v)},null,8,["activeId"])]),_:1},8,["modelValue"])])}}}),Ye=ee(le,[["__scopeId","data-v-58bdce74"]]);export{Ye as default};
