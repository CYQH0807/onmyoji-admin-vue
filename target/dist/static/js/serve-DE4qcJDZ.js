import{i as Q}from"./index-BzwtatPw.js";import"./store-BGvsPsWR.js";import{u as Z}from"./index-OBXFyj3D.js";import{B as ee,X as oe}from"./@element-plus.icons-vue-BCFYf-67.js";import{m as te}from"./marked-BsGX16Ug.js";import{b,a as i}from"./element-plus-DaJS5H-O.js";import{o as ne}from"./lodash-es-I-EvhVFk.js";import{d as U,n as ae,ap as se,Y as a,o as x,J as N,K as s,a as l,i as o,c as le,V as re,F as ce,O as h}from"./@vue.runtime-core-B2X3lOUZ.js";import{k as ie,r as S,u as C}from"./@vue.reactivity-V6IlnEmz.js";import{O as p}from"./@vue.shared-D-bMerGS.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vue.runtime-dom-DkKQpP1Z.js";import"./@vueuse.core-Bp0bPelK.js";import"./@vueuse.shared-CZpoHp70.js";import"./mitt-C1z4c41a.js";import"./axios-CvWkLj0m.js";import"./nprogress-B7fG2QpQ.js";import"./chardet-C_72lc3Z.js";import"./pinia-ByvooDwk.js";import"./vue-demi-Dq6ymT-8.js";import"./monaco-editor-CuOEaJz6.js";import"./vue-echarts-BbwyaQnR.js";import"./resize-detector-CZu9PX2v.js";import"./echarts-Bv2MlBtc.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BSc91FC-.js";import"./vue-router-4IlAtr41.js";import"./mockjs-Bfc9hT_P.js";import"./dayjs-DOBku9Nj.js";import"./vue-xN6KRtQP.js";import"./@popperjs.core-D9SI2xQl.js";import"./@ctrl.tinycolor-r5W6hzzQ.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui.dom-B8Qxuwjg.js";import"./@floating-ui.core-DTrSsA1T.js";import"./@floating-ui.utils-Bh-IyuRp.js";const ue={class:"scope"},me={class:"c"},de=["src"],_e={class:"det"},fe={class:"tag"},he={class:"title"},ge={class:"desc"},ve={class:"author"},we={class:"f"},be={class:"scope is-add"},xe={class:"info-header"},Ce=U({name:"helper-plugins-serve"}),ke=U({...Ce,setup(ye){const{service:m,refs:k,setRefs:y}=Z(),T=Q.useForm(),g=ie({active:"installed",onChange(e){e=="shop"&&ae(()=>{g.active="installed",window.open("https://cool-js.com/")})}}),w=S([]),d=S();function V(){m.plugin.info.page().then(e=>{w.value=e.list})}function O(e){var n;(n=T.value)==null||n.open({title:"设置",props:{labelWidth:"60px"},form:{...e},items:[{label:"参数",prop:"config",value:"{}",component:{name:"cl-editor",props:{name:"cl-editor-monaco",ref:y("editor")}}},{label:" ",flex:!1,component:{name:"slot-upload"}},{label:"状态",prop:"status",component:{name:"cl-switch"}}],on:{submit(r,{done:u,close:c}){m.plugin.info.update(r).then(()=>{i.success("修改成功"),ne(e,r),c()}).catch(v=>{i.error(v.message),u()})}}})}async function P(e){d.value=e,k.editorPreview.open(await te.parse(e.readme))}function j(e,n){b.confirm(`确定要卸载插件【${e.name}】吗？`,"提示",{type:"warning"}).then(()=>{m.plugin.info.delete({ids:[e.id]}).then(()=>{w.value.splice(n,1),i.success("卸载成功")}).catch(r=>{i.error(r.message)})}).catch(()=>null)}function z(e){var n;k.editor.appendContent((n=e[0])==null?void 0:n.url)}function L(e){m.plugin.info.update({id:e.id,status:e.status}).then(()=>{i.success(e.status?"开启成功":"关闭成功")}).catch(n=>{i.error(n.message)})}function B(e){function n(r){const u=new FormData;u.append("files",e),u.append("force",r),m.plugin.info.request({url:"/install",method:"POST",data:u,headers:{"Content-Type":"multipart/form-data"}}).then(c=>{c?b.confirm(c.message,"提示",{type:"warning",confirmButtonText:"继续"}).then(()=>{n("true")}).catch(()=>null):(i.success("插件安装成功"),V())}).catch(c=>{i.error(c.message)})}return n("false"),!1}function M(e){e.preventDefault()}function q(e){if(e.preventDefault(),e.dataTransfer){const n=e.dataTransfer.files[0];b.confirm("检测到插件，是否安装","提示",{type:"warning",confirmButtonText:"安装"}).then(()=>{B(n)}).catch(()=>null)}}return se(()=>{V()}),(e,n)=>{const r=a("el-tab-pane"),u=a("el-tabs"),c=a("el-icon"),v=a("el-tag"),D=a("el-button"),A=a("cl-flex1"),I=a("cl-switch"),F=a("el-col"),J=a("cl-upload"),K=a("el-row"),R=a("cl-editor-preview"),W=a("cl-upload-space"),X=a("el-text"),Y=a("cl-row"),G=a("cl-form"),H=a("el-scrollbar");return x(),N(H,{class:"plugins__wrapper"},{default:s(()=>{var $,E;return[l("div",{class:"plugins",onDragover:M,onDrop:q},[o(u,{modelValue:g.active,"onUpdate:modelValue":n[0]||(n[0]=t=>g.active=t),type:"card",onTabChange:g.onChange},{default:s(()=>[o(r,{label:"已安装插件",name:"installed"}),o(r,{label:"插件市场",name:"shop"})]),_:1},8,["modelValue","onTabChange"]),o(K,{gutter:10},{default:s(()=>[(x(!0),le(ce,null,re(w.value,(t,_)=>(x(),N(F,{key:_,xs:24,sm:12,md:8,lg:6},{default:s(()=>[l("div",ue,[l("div",me,[o(c,{class:"set",onClick:f=>O(t)},{default:s(()=>[o(C(oe))]),_:2},1032,["onClick"]),l("img",{class:"logo",src:"data:image/jpg;base64,"+t.logo},null,8,de),l("div",_e,[l("div",fe,[o(v,{size:"small",effect:"dark"},{default:s(()=>[h(p(t.keyName),1)]),_:2},1024),o(v,{size:"small",effect:"dark",type:"success"},{default:s(()=>[h("v"+p(t.version),1)]),_:2},1024)]),l("p",he,p(t.name||"未知"),1),l("p",ge,p(t.description||"暂无描述"),1),l("div",ve,[l("span",null,p(t.author)+"：",1),l("span",null,p(t.updateTime),1)])])]),l("div",we,[o(D,{round:"",onClick:f=>P(t)},{default:s(()=>[h("详情")]),_:2},1032,["onClick"]),o(D,{type:"danger",round:"",onClick:f=>j(t,_)},{default:s(()=>[h("卸载")]),_:2},1032,["onClick"]),o(A),o(I,{modelValue:t.status,"onUpdate:modelValue":f=>t.status=f,onChange:f=>L(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])])])]),_:2},1024))),128)),o(F,{xs:24,sm:12,md:8,lg:6},{default:s(()=>[o(J,{"before-upload":B,accept:".cool"},{default:s(()=>[l("div",be,[o(c,null,{default:s(()=>[o(C(ee))]),_:1})])]),_:1})]),_:1})]),_:1}),o(R,{ref:C(y)("editorPreview"),name:"wang","show-btn":!1,title:`${($=d.value)==null?void 0:$.name} v${(E=d.value)==null?void 0:E.version} 说明文档`},{prepend:s(()=>{var t,_;return[l("div",xe,[l("span",null,"作者："+p((t=d.value)==null?void 0:t.author),1),l("span",null,"更新时间："+p((_=d.value)==null?void 0:_.updateTime),1)])]}),_:1},8,["title"]),o(G,{ref_key:"Form",ref:T},{"slot-upload":s(()=>[o(Y,null,{default:s(()=>[o(W,{"show-list":!1,multiple:!1,text:"选择文件",onConfirm:z}),o(X,{type:"warning",style:{marginLeft:"10px"}},{default:s(()=>[h("选择后会在光标后插入文件链接")]),_:1})]),_:1})]),_:1},512)],32)]}),_:1})}}}),io=pe(ke,[["__scopeId","data-v-0aa68110"]]);export{io as default};
