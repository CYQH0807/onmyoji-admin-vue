import{w as R}from"./@vue.runtime-dom-DkKQpP1Z.js";import{i as J,n as K}from"./index-BzwtatPw.js";import{r as L,u as Y}from"./xlsx-DrgVwiaB.js";import{b as q}from"./chardet-C_72lc3Z.js";import{a as A}from"./element-plus-DaJS5H-O.js";import{d as I,t as N,Y as g,o as _,c as k,i as l,K as c,O as v,a as b,N as U,F as E,V as G,J as O}from"./@vue.runtime-core-B2X3lOUZ.js";import{k as B}from"./@vue.reactivity-V6IlnEmz.js";import{O as j}from"./@vue.shared-D-bMerGS.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./@vueuse.core-Bp0bPelK.js";import"./@vueuse.shared-CZpoHp70.js";import"./store-BGvsPsWR.js";import"./lodash-es-I-EvhVFk.js";import"./mitt-C1z4c41a.js";import"./axios-CvWkLj0m.js";import"./nprogress-B7fG2QpQ.js";import"./pinia-ByvooDwk.js";import"./vue-demi-Dq6ymT-8.js";import"./monaco-editor-CuOEaJz6.js";import"./vue-echarts-BbwyaQnR.js";import"./resize-detector-CZu9PX2v.js";import"./echarts-Bv2MlBtc.js";import"./tslib-BDyQ-Jie.js";import"./zrender-BSc91FC-.js";import"./vue-router-4IlAtr41.js";import"./mockjs-Bfc9hT_P.js";import"./dayjs-DOBku9Nj.js";import"./vue-xN6KRtQP.js";import"./@element-plus.icons-vue-BCFYf-67.js";import"./@popperjs.core-D9SI2xQl.js";import"./@ctrl.tinycolor-r5W6hzzQ.js";import"./async-validator-CRbnkQr6.js";import"./memoize-one-BdPwpGay.js";import"./normalize-wheel-es-B6fDCfyv.js";import"./@floating-ui.dom-B8Qxuwjg.js";import"./@floating-ui.core-DTrSsA1T.js";import"./@floating-ui.utils-Bh-IyuRp.js";const Q={key:0,class:"upload"},W={class:"tips"},X={class:"inner"},Z={key:0,class:"data-table"},ee={class:"head"},te={class:"cl-table"},oe={key:0},ne={class:"pagination"},ie=I({name:"cl-import-btn"}),le=I({...ie,props:{onConfig:Function,onSubmit:Function,template:{type:String,default:""},tips:{type:String,default:"请按照模版填写信息"},limitSize:{type:Number,default:10},type:{type:String,default:"success"},icon:String,disabled:Boolean,accept:{type:String,default:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel,text/csv"}},emits:["change"],setup(d,{expose:T,emit:$}){const x=d,D=$,S=J.useForm(),o=B({filename:"",file:null,list:[]}),a=B({size:20,page:1,onCurrentChange(e){a.page=e}}),r=B({header:[],selection:[],del(e){e!==void 0?o.list.splice(e,1):o.list=o.list.filter(n=>!r.selection.includes(n._index))},onIndex(e){return e+1+(a.page-1)*a.size},onSelectionChange(e){r.selection=e.map(n=>n._index)}}),V=N(()=>o.list.filter((e,n)=>n>=(a.page-1)*a.size&&n<a.page*a.size));function w(){o.filename="",o.file=null,o.list=[],r.header=[],r.selection=[]}function F(){var e;w(),(e=S.value)==null||e.open({title:"导入",width:N(()=>o.filename?"80%":"800px"),dialog:{"close-on-press-escape":!1},items:[...x.onConfig?x.onConfig(S):[],{prop:"file",component:{name:"slot-upload"}},{component:{name:"slot-list"}}],op:{saveButtonText:"提交"},on:{submit(n,{done:s,close:u}){if(!o.filename)return s(),A.error("请选择文件");x.onSubmit?x.onSubmit(o,{done:s,close:u}):(A.error("<cl-import-btn /> 未配置 onSubmit 参数"),s())}}})}function M(e,n,{next:s}){const u=new FileReader,p=K(e.name);return u.onload=y=>{var m;let C="";if(p=="csv"){const i=q.detect(new Uint8Array(y.target.result));C=new TextDecoder(i).decode(y.target.result)}else C=y.target.result;const f=L(C,{type:"binary",raw:p=="csv"});let h=[];for(const i in f.Sheets)f.Sheets.hasOwnProperty(i)&&(h=h.concat(Y.sheet_to_json(f.Sheets[i])));o.list=h.map((i,z)=>({...i,_index:z})),o.filename=e.name,o.file=e;const t=f.Sheets[Object.keys(f.Sheets)[0]];for(let i in t){if(i[0]==="!")continue;((m=i.match(/[0-9]+/))==null?void 0:m[0])=="1"&&r.header.push(t[i].v)}D("change",h)},p=="csv"?u.readAsArrayBuffer(e):u.readAsBinaryString(e),s(),!1}function P(){const e=document.createElement("a");e.setAttribute("href",x.template),e.setAttribute("download",""),e.click()}return T({open:F,clear:w,Form:S}),(e,n)=>{const s=g("el-button"),u=g("cl-upload"),p=g("el-table-column"),y=g("el-input"),C=g("el-table"),f=g("el-pagination"),h=g("cl-form");return _(),k(E,null,[l(s,{icon:d.icon,disabled:d.disabled,type:d.type,onClick:F},{default:c(()=>[v("导入")]),_:1},8,["icon","disabled","type"]),l(h,{ref_key:"Form",ref:S},{"slot-upload":c(()=>[o.filename?U("",!0):(_(),k("div",Q,[b("div",W,[b("span",null,j(d.tips),1),l(s,{type:"primary",text:"",bg:"",onClick:P},{default:c(()=>[v("下载模版")]),_:1})]),b("div",X,[l(u,{drag:"",type:"file","limit-size":d.limitSize,accept:d.accept,disabled:d.disabled,"auto-upload":!1,"before-upload":M,size:[220,"100%"]},null,8,["limit-size","accept","disabled"])])]))]),"slot-list":c(()=>[V.value.length?(_(),k("div",Z,[b("div",ee,[l(s,{type:"success",onClick:w},{default:c(()=>[v("重新上传")]),_:1}),l(s,{type:"danger",disabled:r.selection.length==0,onClick:n[0]||(n[0]=t=>r.del())},{default:c(()=>[v("批量删除")]),_:1},8,["disabled"])]),b("div",te,[l(C,{border:"",small:"",data:V.value,"max-height":"600px",onSelectionChange:r.onSelectionChange,onRowClick:n[1]||(n[1]=t=>{t._edit=!0})},{default:c(()=>[l(p,{type:"selection",width:"60px",align:"center",fixed:"left"}),l(p,{label:"序号",type:"index",width:"80px",align:"center",fixed:"left",index:r.onIndex},null,8,["index"]),(_(!0),k(E,null,G(r.header,t=>(_(),O(p,{key:t,prop:t,label:t,"min-width":"160px",align:"center"},{default:c(m=>[m.row._edit?(_(),O(y,{key:1,type:"textarea",modelValue:m.row[t],"onUpdate:modelValue":i=>m.row[t]=i,clearable:"",placeholder:t},null,8,["modelValue","onUpdate:modelValue","placeholder"])):(_(),k("span",oe,j(m.row[t]),1))]),_:2},1032,["prop","label"]))),128)),l(p,{label:"操作",width:"100px",align:"center",fixed:"right"},{default:c(t=>[l(s,{text:"",bg:"",type:"danger",onClick:R(m=>r.del(t.$index),["stop"])},{default:c(()=>[v("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])]),b("div",ne,[l(f,{background:"",layout:"total, prev, pager, next",total:o.list.length,"page-size":a.size,"current-page":a.page,"onUpdate:currentPage":n[2]||(n[2]=t=>a.page=t),onCurrentChange:a.onCurrentChange},null,8,["total","page-size","current-page","onCurrentChange"])])])):U("",!0)]),_:1},512)],64)}}}),Je=H(le,[["__scopeId","data-v-6414e513"]]);export{Je as default};
